# MPF Labs — Book Catalog (Spring Boot)

Навчальний вебзастосунок для демонстрації типового стеку Spring Boot:
- автентифікація/авторизація (ролі користувачів),
- каталог книг + коментарі,
- PostgreSQL + JPA/Hibernate,
- міграції БД через Flyway,
- деплой на Render.

## Ролі та доступ
У системі використовуються ролі:
- `REGISTERED` — базовий користувач (за замовчуванням).
- `USER` — може додавати/видаляти коментарі.
- `MODERATOR` — може додавати книги.
- `ADMIN` — доступ до службових ендпоінтів (наприклад, `/actuator/**`).

> Примітка: правила доступу визначені у `SecurityConfig`.

---

## Два “seeders”

У проєкті є **два різні механізми початкового наповнення**, бо вони вирішують **різні задачі**.

### 1) Seeder №1 — Flyway SQL-міграції (структура БД)
**Що робить:** автоматично створює/оновлює *схему бази даних* (таблиці, колонки, constraints, індекси) під час старту застосунку.

**Навіщо:** це “джерело правди” для структури БД — щоб у всіх середовищах (локально/CI/Render) була однакова схема і проєкт піднімався без ручних дій.

**Де знаходиться:** `src/main/resources/db/migration/*`  
(файли `V__*.sql`, які виконує Flyway)

**Важливо:** цей seeder **не повинен зберігати реальні паролі/готові адмін-акаунти** у репозиторії.

---

### 2) Seeder №2 — консольний інсертер акаунтів (дані/користувачі)
**Що робить:** окремий Java-скрипт/клас, який підключається до *вже створеної* PostgreSQL (наприклад, на Render) і **додає 2 записи користувачів**: `ADMIN` та `MODERATOR`.

**Навіщо:**
- у прод/демо середовищі потрібно швидко отримати доступ до функцій модератора/адміна;
- credentials вводяться **з консолі**, тому секрети не потрапляють у git;
- можна запустити один раз “коли треба”, не змішуючи це з міграціями схеми.

**Важливо:** цей seeder **працює тільки з даними** (INSERT у `users`), а не з DDL/міграціями.

---

## Запуск
### Локально
1. Налаштуйте PostgreSQL і змінні середовища (URL/USER/PASSWORD).
2. Запустіть застосунок — Flyway сам підніме схему.

### Render
- застосунок доступний за адресою: `https://mpf-labs.onrender.com/`
- база даних — PostgreSQL (Render managed DB)

---

## Примітки
- Якщо email-розсилка налаштована через сторонній сервіс (Resend), у тестовому режимі сервіс може дозволяти надсилати листи лише на “owner email”, поки не підтверджено домен відправника.
- Посилання підтвердження акаунту формуються з `app.base-url` (його треба задати як `https://mpf-labs.onrender.com` у відповідному середовищі).
